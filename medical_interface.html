<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical PDF RAG System</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f7fa;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .tabs {
            display: flex;
            border-bottom: 2px solid #e1e8ed;
            margin-bottom: 30px;
        }
        .tab-button {
            flex: 1;
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #5a6c7d;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }
        .tab-button.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background-color: #f8f9ff;
        }
        .tab-button:hover {
            background-color: #f1f3f4;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .section {
            margin-bottom: 30px;
            padding: 25px;
            border: 1px solid #e1e8ed;
            border-radius: 10px;
            background: #fafbfc;
        }
        .section h2 {
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
        }
        input[type="file"], input[type="text"], textarea, select {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        input[type="file"]:focus, input[type="text"]:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 120px;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .result {
            background-color: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            white-space: pre-wrap;
            line-height: 1.6;
        }
        .error {
            background-color: #fed7d7;
            border-color: #feb2b2;
            color: #c53030;
        }
        .success {
            background-color: #c6f6d5;
            border-color: #9ae6b4;
            color: #2f855a;
        }
        .source {
            background-color: #edf2f7;
            border-left: 4px solid #4299e1;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .medical-icon {
            font-size: 1.2em;
            margin-right: 8px;
        }
        .tags-input {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }
        .tag {
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 16px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .tag-remove {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 14px;
            padding: 0;
            margin: 0;
            min-width: auto;
        }
        .medical-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            display: block;
        }
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        .condition-card {
            background: white;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        .condition-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }
        .condition-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .condition-name {
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
        }
        .probability-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }
        .severity-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            text-transform: uppercase;
        }
        .severity-low {
            background: #c6f6d5;
            color: #2f855a;
        }
        .severity-medium {
            background: #fed7aa;
            color: #c05621;
        }
        .severity-high {
            background: #fed7d7;
            color: #c53030;
        }
        .urgency-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            text-transform: uppercase;
            margin-left: 8px;
        }
        .urgency-routine {
            background: #bee3f8;
            color: #2c5282;
        }
        .urgency-soon {
            background: #fbb6ce;
            color: #97266d;
        }
        .urgency-urgent {
            background: #feb2b2;
            color: #c53030;
        }
        .recommendations {
            margin: 15px 0;
        }
        .recommendations h4 {
            color: #4a5568;
            margin-bottom: 8px;
            font-size: 1em;
        }
        .recommendations ul {
            margin: 0;
            padding-left: 20px;
        }
        .recommendations li {
            margin: 4px 0;
            color: #2d3748;
        }
        .specialists {
            margin-top: 15px;
        }
        .specialists h4 {
            color: #4a5568;
            margin-bottom: 8px;
            font-size: 1em;
        }
        .specialist-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        .specialist-tag {
            background: #edf2f7;
            color: #4a5568;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
        }
        .emergency-warning {
            background: #fed7d7;
            border: 2px solid #feb2b2;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            color: #c53030;
            font-weight: bold;
        }
        .general-advice {
            background: #e6fffa;
            border: 2px solid #81e6d9;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            color: #234e52;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè• Medical PDF RAG System</h1>
        
        <div class="medical-stats">
            <div class="stat-card">
                <span class="stat-number" id="medicalDocsCount">0</span>
                <span class="stat-label">Medical Documents</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="patientReportsCount">0</span>
                <span class="stat-label">Patient Reports</span>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab-button active" onclick="openTab(event, 'medical-docs')">
                <span class="medical-icon">üìö</span>Medical Knowledge Base
            </button>
            <button class="tab-button" onclick="openTab(event, 'symptom-analysis')">
                <span class="medical-icon">üîç</span>Symptom Analysis
            </button>
            <button class="tab-button" onclick="openTab(event, 'patient-reports')">
                <span class="medical-icon">üè•</span>Patient Reports & Analysis
            </button>
        </div>
        
        <!-- Medical Documents Tab -->
        <div id="medical-docs" class="tab-content active">
            <!-- PDF Upload Section -->
            <div class="section">
                <h2>ÔøΩ Upload Medical PDF</h2>
                <p>Upload medical PDFs (textbooks, research papers, clinical guidelines) to automatically extract and add to the knowledge base.</p>
                
                <div class="form-group">
                    <label for="medicalPdfFile">Medical PDF File *</label>
                    <input type="file" id="medicalPdfFile" accept=".pdf" required>
                </div>
                
                <button onclick="uploadMedicalPdf()">
                    üì§ Upload Medical PDF
                </button>
                
                <div class="loading" id="pdfLoading">
                    <div class="spinner"></div>
                    <p>Processing medical PDF...</p>
                </div>
                
                <div id="pdfUploadResult"></div>
            </div>
            
            <!-- Manual Text Entry Section -->
            <div class="section">
                <h2>ÔøΩüìñ Add Medical Document (Manual Entry)</h2>
                <p>Manually enter medical information about diseases, treatments, and medicines to build the knowledge base.</p>
                
                <div class="form-group">
                    <label for="docTitle">Document Title *</label>
                    <input type="text" id="docTitle" placeholder="e.g., Diabetes Type 2 Treatment Guidelines" required>
                </div>
                
                <div class="form-group">
                    <label for="docDisease">Disease/Condition</label>
                    <input type="text" id="docDisease" placeholder="e.g., Type 2 Diabetes">
                </div>
                
                <div class="form-group">
                    <label for="docMedicine">Medicine/Treatment</label>
                    <input type="text" id="docMedicine" placeholder="e.g., Metformin, Insulin therapy">
                </div>
                
                <div class="form-group">
                    <label for="docTags">Tags (press Enter to add)</label>
                    <input type="text" id="docTags" placeholder="e.g., endocrinology, chronic">
                    <div class="tags-input" id="tagsList"></div>
                </div>
                
                <div class="form-group">
                    <label for="docContent">Medical Content *</label>
                    <textarea id="docContent" placeholder="Enter detailed medical information about the disease, symptoms, treatments, contraindications, etc." required></textarea>
                </div>
                
                <button onclick="uploadMedicalDocument()">
                    üì§ Add to Knowledge Base
                </button>
                
                <div class="loading" id="medicalLoading">
                    <div class="spinner"></div>
                    <p>Adding medical document...</p>
                </div>
                
                <div id="medicalResult"></div>
            </div>
        </div>
        
        <!-- Symptom Analysis Tab -->
        <div id="symptom-analysis" class="tab-content">
            <div class="section">
                <h2>üîç Symptom Analysis</h2>
                <p>Enter your symptoms to get potential conditions and recommendations based on uploaded medical knowledge.</p>
                
                <div class="form-group">
                    <label for="symptomInput">Add Symptoms *</label>
                    <input type="text" id="symptomInput" placeholder="e.g., headache, fever, nausea (press Enter to add)">
                    <div class="tags-input" id="symptomsList"></div>
                </div>
                
                <div class="form-group">
                    <label for="patientAge">Age (optional)</label>
                    <input type="number" id="patientAge" placeholder="e.g., 35" min="1" max="120">
                </div>
                
                <div class="form-group">
                    <label for="patientGender">Gender (optional)</label>
                    <select id="patientGender">
                        <option value="">Select gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="additionalInfo">Additional Information (optional)</label>
                    <textarea id="additionalInfo" placeholder="Any additional details about your symptoms, duration, severity, etc."></textarea>
                </div>
                
                <button onclick="analyzeSymptoms()">
                    üîç Analyze Symptoms
                </button>
                
                <div class="loading" id="symptomLoading">
                    <div class="spinner"></div>
                    <p>Analyzing symptoms...</p>
                </div>
                
                <div id="symptomResult"></div>
            </div>
        </div>
        
        <!-- Patient Reports Tab -->
        <div id="patient-reports" class="tab-content">
            <div class="section">
                <h2>üìã Upload Patient Report</h2>
                <p>Upload patient medical reports (PDF) for analysis and consultation.</p>
                
                <div class="form-group">
                    <label for="patientFile">Patient Report PDF *</label>
                    <input type="file" id="patientFile" accept=".pdf" required>
                </div>
                
                <button onclick="uploadPatientReport()">
                    üì§ Upload Patient Report
                </button>
                
                <div class="loading" id="patientLoading">
                    <div class="spinner"></div>
                    <p>Processing patient report...</p>
                </div>
                
                <div id="patientUploadResult"></div>
            </div>
            
            <div class="section">
                <h2>üí¨ Medical Consultation</h2>
                <p>Ask questions about uploaded patient reports and get medical insights.</p>
                
                <div class="form-group">
                    <label for="medicalQuestion">Medical Question</label>
                    <textarea id="medicalQuestion" placeholder="e.g., What does this blood test indicate? What are the potential diagnoses? What treatment options are recommended?"></textarea>
                </div>
                
                <button onclick="askMedicalQuestion()">
                    üîç Get Medical Analysis
                </button>
                
                <div class="loading" id="queryLoading">
                    <div class="spinner"></div>
                    <p>Analyzing medical data...</p>
                </div>
                
                <div id="queryResult"></div>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_BASE_URL = 'https://mental-health-ai-backend-suggestion.onrender.com';
        
        // Helper function to build API URLs
        function buildApiUrl(endpoint) {
            return `${API_BASE_URL}${endpoint}`;
        }
        
        let currentTags = [];
        let currentSymptoms = [];
        
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].classList.remove("active");
            }
            tablinks = document.getElementsByClassName("tab-button");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove("active");
            }
            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");
        }
        
        // Tags functionality
        document.getElementById('docTags').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                addTag();
            }
        });
        
        // Symptoms functionality
        document.getElementById('symptomInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                addSymptom();
            }
        });
        
        function addTag() {
            const input = document.getElementById('docTags');
            const tag = input.value.trim();
            if (tag && !currentTags.includes(tag)) {
                currentTags.push(tag);
                input.value = '';
                updateTagsList();
            }
        }
        
        function removeTag(tag) {
            currentTags = currentTags.filter(t => t !== tag);
            updateTagsList();
        }
        
        function updateTagsList() {
            const tagsList = document.getElementById('tagsList');
            tagsList.innerHTML = currentTags.map(tag => 
                `<span class="tag">${tag}<button class="tag-remove" onclick="removeTag('${tag}')">√ó</button></span>`
            ).join('');
        }
        
        function addSymptom() {
            const input = document.getElementById('symptomInput');
            const symptom = input.value.trim();
            if (symptom && !currentSymptoms.includes(symptom)) {
                currentSymptoms.push(symptom);
                input.value = '';
                updateSymptomsList();
            }
        }
        
        function removeSymptom(symptom) {
            currentSymptoms = currentSymptoms.filter(s => s !== symptom);
            updateSymptomsList();
        }
        
        function updateSymptomsList() {
            const symptomsList = document.getElementById('symptomsList');
            symptomsList.innerHTML = currentSymptoms.map(symptom => 
                `<span class="tag">${symptom}<button class="tag-remove" onclick="removeSymptom('${symptom}')">√ó</button></span>`
            ).join('');
        }
        
        async function uploadMedicalPdf() {
            const fileInput = document.getElementById('medicalPdfFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showResult('pdfUploadResult', 'Please select a PDF file.', 'error');
                return;
            }
            
            const loading = document.getElementById('pdfLoading');
            const resultDiv = document.getElementById('pdfUploadResult');
            
            loading.style.display = 'block';
            resultDiv.innerHTML = '';
            
            const formData = new FormData();
            formData.append('file', file);
            
            try {
                const response = await fetch(buildApiUrl('/upload-medical-pdf'), {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    let resultHTML = `<h3>‚úÖ Upload Successful!</h3>`;
                    resultHTML += `<p><strong>Document ID:</strong> ${result.document_id}</p>`;
                    resultHTML += `<p><strong>Filename:</strong> ${result.filename}</p>`;
                    resultHTML += `<p><strong>File Size:</strong> ${result.file_size_chars} characters</p>`;
                    resultHTML += `<p><strong>Medical Content:</strong> ${result.is_medical_content ? 'Yes' : 'No'}</p>`;
                    resultHTML += `<p><strong>Confidence Score:</strong> ${(result.confidence_score * 100).toFixed(1)}%</p>`;
                    
                    if (result.content_analysis) {
                        const analysis = result.content_analysis;
                        resultHTML += `<h4>üìä Content Analysis:</h4>`;
                        resultHTML += `<p><strong>Content Types:</strong> ${analysis.content_types.join(', ') || 'General'}</p>`;
                        
                        if (analysis.diseases_found.length > 0) {
                            resultHTML += `<p><strong>Diseases Found:</strong> ${analysis.diseases_found.slice(0, 5).join(', ')}${analysis.diseases_found.length > 5 ? '...' : ''}</p>`;
                        }
                        
                        if (analysis.medications_found.length > 0) {
                            resultHTML += `<p><strong>Medications Found:</strong> ${analysis.medications_found.slice(0, 5).join(', ')}${analysis.medications_found.length > 5 ? '...' : ''}</p>`;
                        }
                        
                        if (analysis.symptoms_found.length > 0) {
                            resultHTML += `<p><strong>Symptoms Found:</strong> ${analysis.symptoms_found.slice(0, 5).join(', ')}${analysis.symptoms_found.length > 5 ? '...' : ''}</p>`;
                        }
                        
                        if (analysis.total_medical_entities) {
                            const entities = analysis.total_medical_entities;
                            resultHTML += `<p><strong>Total Medical Entities:</strong> ${entities.diseases} diseases, ${entities.medications} medications, ${entities.symptoms} symptoms</p>`;
                        }
                    }
                    
                    if (result.processing_details) {
                        const details = result.processing_details;
                        resultHTML += `<h4>‚öôÔ∏è Processing Details:</h4>`;
                        resultHTML += `<p><strong>Chunks Created:</strong> ${details.chunks_created}</p>`;
                        resultHTML += `<p><strong>Collection Used:</strong> ${details.collection_used}</p>`;
                        resultHTML += `<p><strong>Processing Time:</strong> ${details.processing_time} seconds</p>`;
                    }
                    
                    if (result.recommendations && result.recommendations.length > 0) {
                        resultHTML += `<h4>üí° Recommendations:</h4>`;
                        resultHTML += `<ul>`;
                        result.recommendations.forEach(rec => {
                            resultHTML += `<li>${rec}</li>`;
                        });
                        resultHTML += `</ul>`;
                    }
                    
                    showResult('pdfUploadResult', resultHTML, 'success');
                    fileInput.value = '';
                } else {
                    showResult('pdfUploadResult', `‚ùå Error: ${result.detail}`, 'error');
                }
            } catch (error) {
                showResult('pdfUploadResult', `‚ùå Error: ${error.message}`, 'error');
            } finally {
                loading.style.display = 'none';
            }
        }

        async function uploadMedicalDocument() {
            const title = document.getElementById('docTitle').value;
            const content = document.getElementById('docContent').value;
            const disease = document.getElementById('docDisease').value;
            const medicine = document.getElementById('docMedicine').value;
            
            if (!title.trim() || !content.trim()) {
                showResult('medicalResult', 'Please fill in the title and content fields.', 'error');
                return;
            }
            
            const loading = document.getElementById('medicalLoading');
            const resultDiv = document.getElementById('medicalResult');
            
            loading.style.display = 'block';
            resultDiv.innerHTML = '';
            
            try {
                const response = await fetch(buildApiUrl('/upload-medical-document'), {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        title: title,
                        content: content,
                        disease: disease || null,
                        medicine: medicine || null,
                        tags: currentTags
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showResult('medicalResult', `‚úÖ ${result.status}\nDocument ID: ${result.document_id}`, 'success');
                    // Clear form
                    document.getElementById('docTitle').value = '';
                    document.getElementById('docContent').value = '';
                    document.getElementById('docDisease').value = '';
                    document.getElementById('docMedicine').value = '';
                    currentTags = [];
                    updateTagsList();
                } else {
                    showResult('medicalResult', `‚ùå Error: ${result.detail}`, 'error');
                }
            } catch (error) {
                showResult('medicalResult', `‚ùå Error: ${error.message}`, 'error');
            } finally {
                loading.style.display = 'none';
            }
        }
        
        async function analyzeSymptoms() {
            if (currentSymptoms.length === 0) {
                showResult('symptomResult', 'Please add at least one symptom.', 'error');
                return;
            }
            
            const age = document.getElementById('patientAge').value;
            const gender = document.getElementById('patientGender').value;
            const additionalInfo = document.getElementById('additionalInfo').value;
            
            const loading = document.getElementById('symptomLoading');
            const resultDiv = document.getElementById('symptomResult');
            
            loading.style.display = 'block';
            resultDiv.innerHTML = '';
            
            try {
                const requestData = {
                    symptoms: currentSymptoms,
                    age: age ? parseInt(age) : null,
                    gender: gender || null,
                    additional_info: additionalInfo || null
                };
                
                const response = await fetch(buildApiUrl('/symptom-analysis'), {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    let resultHTML = `<h3>üîç Symptom Analysis Results</h3>`;
                    
                    // Emergency warning if present
                    if (result.emergency_warning) {
                        resultHTML += `<div class="emergency-warning">‚ö†Ô∏è <strong>Emergency Warning:</strong> ${result.emergency_warning}</div>`;
                    }
                    
                    // General advice
                    if (result.general_advice) {
                        resultHTML += `<div class="general-advice"><strong>General Advice:</strong> ${result.general_advice}</div>`;
                    }
                    
                    // Conditions
                    if (result.conditions && result.conditions.length > 0) {
                        resultHTML += `<h4>Potential Conditions:</h4>`;
                        
                        result.conditions.forEach((condition, index) => {
                            resultHTML += `
                                <div class="condition-card">
                                    <div class="condition-header">
                                        <div class="condition-name">${condition.name}</div>
                                        <div class="probability-badge">${condition.probability}%</div>
                                    </div>
                                    
                                    <div style="margin-bottom: 10px;">
                                        <span class="severity-badge severity-${condition.severity}">
                                            ${condition.severity} severity
                                        </span>
                                        <span class="urgency-badge urgency-${condition.urgency}">
                                            ${condition.urgency}
                                        </span>
                                    </div>
                                    
                                    ${condition.recommendations && condition.recommendations.length > 0 ? `
                                        <div class="recommendations">
                                            <h4>Recommendations:</h4>
                                            <ul>
                                                ${condition.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                                            </ul>
                                        </div>
                                    ` : ''}
                                    
                                    ${condition.specialists && condition.specialists.length > 0 ? `
                                        <div class="specialists">
                                            <h4>Recommended Specialists:</h4>
                                            <div class="specialist-tags">
                                                ${condition.specialists.map(spec => `<span class="specialist-tag">${spec}</span>`).join('')}
                                            </div>
                                        </div>
                                    ` : ''}
                                </div>
                            `;
                        });
                    } else {
                        resultHTML += `<p>No specific conditions identified. Please consult with a healthcare professional for proper evaluation.</p>`;
                    }
                    
                    resultHTML += `<div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; font-style: italic; color: #6c757d;">
                        <strong>Disclaimer:</strong> This analysis is based on uploaded medical documents and should not replace professional medical advice. 
                        Always consult with a qualified healthcare provider for proper diagnosis and treatment.
                    </div>`;
                    
                    showResult('symptomResult', resultHTML, 'success');
                } else {
                    showResult('symptomResult', `‚ùå Error: ${result.detail}`, 'error');
                }
            } catch (error) {
                showResult('symptomResult', `‚ùå Error: ${error.message}`, 'error');
            } finally {
                loading.style.display = 'none';
            }
        }
        
        async function uploadPatientReport() {
            const fileInput = document.getElementById('patientFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showResult('patientUploadResult', 'Please select a PDF file.', 'error');
                return;
            }
            
            const loading = document.getElementById('patientLoading');
            const resultDiv = document.getElementById('patientUploadResult');
            
            loading.style.display = 'block';
            resultDiv.innerHTML = '';
            
            const formData = new FormData();
            formData.append('file', file);
            
            try {
                const response = await fetch(buildApiUrl('/upload-patient-report'), {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showResult('patientUploadResult', `‚úÖ ${result.status}\nDocument ID: ${result.document_id}`, 'success');
                    fileInput.value = '';
                } else {
                    showResult('patientUploadResult', `‚ùå Error: ${result.detail}`, 'error');
                }
            } catch (error) {
                showResult('patientUploadResult', `‚ùå Error: ${error.message}`, 'error');
            } finally {
                loading.style.display = 'none';
            }
        }
        
        async function askMedicalQuestion() {
            const question = document.getElementById('medicalQuestion').value;
            
            if (!question.trim()) {
                showResult('queryResult', 'Please enter a medical question.', 'error');
                return;
            }
            
            const loading = document.getElementById('queryLoading');
            const resultDiv = document.getElementById('queryResult');
            
            loading.style.display = 'block';
            resultDiv.innerHTML = '';
            
            try {
                const response = await fetch(buildApiUrl('/medical-query'), {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        question: question,
                        max_results: 5
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    let resultHTML = `<h3>üîç Medical Analysis</h3><p><strong>Question:</strong> ${result.question}</p><p><strong>Answer:</strong></p><p>${result.answer}</p>`;
                    
                    if (result.sources && result.sources.length > 0) {
                        resultHTML += '<h4>üìö Medical Sources:</h4>';
                        result.sources.forEach((source, index) => {
                            resultHTML += `<div class="source">
                                <strong>Source ${index + 1}:</strong> ${source.metadata.document_type || 'Document'}<br>
                                <em>Relevance: ${(source.similarity * 100).toFixed(1)}%</em><br>
                                ${source.content}
                            </div>`;
                        });
                    }
                    
                    resultHTML += `<p><em>Context used: ${result.context_used} medical documents</em></p>`;
                    showResult('queryResult', resultHTML, 'success');
                } else {
                    showResult('queryResult', `‚ùå Error: ${result.detail}`, 'error');
                }
            } catch (error) {
                showResult('queryResult', `‚ùå Error: ${error.message}`, 'error');
            } finally {
                loading.style.display = 'none';
            }
        }
        
        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = message;
            element.className = `result ${type}`;
        }
        
        // Load system stats on page load
        async function loadSystemStats() {
            try {
                const response = await fetch(buildApiUrl('/system-info'));
                const info = await response.json();
                
                // Update stats if available
                if (info.collections) {
                    // This would need to be implemented in the backend
                    // For now, just show placeholder
                }
            } catch (error) {
                console.log('Could not load system stats:', error);
            }
        }
        
        // Load stats when page loads
        window.addEventListener('load', loadSystemStats);
    </script>
</body>
</html>
